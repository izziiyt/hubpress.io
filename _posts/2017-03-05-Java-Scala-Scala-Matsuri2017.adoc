= JavaエンジニアにScalaの話を聞いてみたい@ScalaMatsuri2017

//:hp-image: /covers/cover.png
:published_at: 2017-03-05
:hp-tags: ScalaMatsuri2017,Scala

//:hp-alt-title: My English Title

せっかく座長やったんだったら内容をまとめてくれとseraさんに言われたので、やってみました。

2016年には学生ボランティアとしてScalaMatsuriに参加し、
今年のScalaMatsuriには社会人エンジニアとして参加させていただきました。

2016年はScalaのフレームワークを用いたサービス、アーキテクチャにあまり興味がなく（研究のために使っていただけなので。。。）、一番研究に近そうな機械学習に関するセッションは「数式は省きます」、のせいでセッションの大半はつまらない。Scalaエンジニアと知り合えたこと、Scalaの開発におけるtipsを知ることができたのが実りという感想でした。なんとなくで参加するのはダメですね(笑)

一方2017年はエンジニアとしての価値観を装備し、「streamに関して知見を集めてこい」との上司の司令もあって、目的ドリブン（なんだかトートロジー）で参加してみると実りの多さに興奮しました。
昨年の参加経験によって私のことを覚えてくださっていた方もチラホラいらっしゃり、積極的に話しかけていくことで寂しい思いをせずに楽しむことができました。

*去年の参加経験は無駄ではなかったんやー！！(喜)*


まえがきはこの辺りにして”聞きたい側”として座長を務めさせていただいたセッションでの議論を以下にまとめます。

== JavaエンジニアにScalaの話を聞きたい

このセッションタイトル名からは先生と生徒という確立した立場での議論になるかなと思ったのですが、結果として教える側教わる側という立場を超えた議論ができたのでないかと思います。

議題は主に以下の４つです。

. Scalaのメリット
. ScalaとJavaの親和性
. 言語間の移動が面倒（文法忘れちゃう）
. JavaからScalaにチームで移行するには



=== 1.Scalaのメリット
コードが減る。型で頑健性の高いコードがかける。
初心者にとってはまずコードが減るというのが大きなメリットかと。末尾再帰最適化もある。それでいてJavaの資産が使える。ベターJavaとして使うので全然メリット感じられるよ（ベターJavaの境界はなんとなく明示的に”モナドで包む”とか言い出さない範囲という共通認識はあるっぽい）ScalaMatsuriではモナモナするのが受けているがデータ分析系の高見さんや自分はデカいデータを処理できて簡単に実装できるHigh Productivity Languageとして使用しており、ガリガリindex for書いてます。複雑な数式を実装に落とすのが早くて簡単、動作も早い，とは言ってもコアじゃない部分は関数型的に書いたほうが見通しがいい場面がほとんどです。nullを返すというのはバグの原因の追求が難しく、複雑なシステムを作る上でnullを返さない世界はいいぞとのことです。


=== 2.ScalaとJavaの親和性
Scalaのオブジェクトにはcase classやtrait,ObjectというJavaにはない概念がある。そうしたオブジェクトを呼ぶことは問題になる。
例えばtraitは実装がなければJavaのinterfaceになるが実装をつけると複数のclassが作成されてしまう。abstract classを噛ませよう。sealed traitは継承することができてしまう。case classやObjectを呼び出すことの具体的な問題点は聞いていないがやってはいけない。

意外に落とし穴なのが設計思想が異なることで、ScalaからJavaの実装を呼ぶとガンガンnullが返ってきたりしてしてビビる。貧弱なJavaの型からScalaの型へはimplicit　conversion, converterでよしなにやってくれる。逆はScalaエンジニアなら困らないかもしれないがJavaが主役であればJavaの設計思想に合わせたラッパを噛ませる必要があるかも（？）

=== 3.言語間の移動が面倒

Scala書いてJava書いてpython書いて。。。Scala書くとセミコロンつけちゃう。

わかるー（一同）

でもIDE使ってれば教えてくれるし一時間もすれば元通りでは。*JetBrainsにお布施しよう！*

=== 4.JavaからScalaにチーム移行するには

まずメリットの共有が重要。
PerlからScalaに移行した話、Perl嫌だーってなってて型に守られた安全性の高いScalaの環境にみんな心から満足して移行した。
Javaからの場合、*Javaに満足していたら移行するメリットなさそうですよね？*
Javaをわかる人なら感動する。Javaの面倒臭いところが本当に簡単に書ける。
でもデメリットもあるよね。

ScalaScalaしたコードを書く、つまり関数型しようとするとオブジェクトの生成というロスがある。これはFinchの話でもでてきたことで90%にスピードが落ちるがそれを上回る型によるの安全性のメリットがある。Java likeなコードはScalaでも書けるのでそこは適材適所。
*検証が大事。*おいおいパフォーマンスが落ちたぞー怒みたいのがあると思う。
話を聞く限りにおいてScalaのほうが良いという意見なのでそこは高いScala技術をもってすればいい着地点に到達できると思う

*書き方の多様性やばい。*
わかるー（一同）
ライブラリによって独自DSLがあって演算子の意味が違っておこ
DSL糞に思える
でも例えばSpringとかヤバいし（わかる）、DSLっていい解なのでは
DSLを簡単に書けるのはいいことなのでは
macro(関数型の文脈)が散乱するとヤバそうだけどDSLはあくまで概念的には演算子だし（確か）、Scalaエンジニア的にはそんなにおこじゃない。IntelliJ使ってれば予測変換候補からAPI開いてふむふむからの選択ができるしね
*JetBrainｓにお布施しよう！*
個人で移行する分には自分のペースでScalaライクなコードに成長させていくことができるが、チームでやるには制約を決める必要がある。一人が突っ走ってFree monadがそこら中に転がってみんな読めないことがあった。とは言うものの個人個人がいいものを見つけたら共有してチームのScalaレベルを上げる必要もある。ただそれが徐々に積み重なるとヤバくなると思うので*Scalaをわかる人が制約を決める必要があると思う。*

結論

JavaからScalaに変えるメリットは -> いっぱいあるから触ってみて！習熟することで見えるメリット、気にならなくなるデメリットがある！

ScalaとJavaの親和性 -> 高い。だだし技術的な障壁もあるが文化的な障壁もある

言語間の移動が面倒 -> IntelliJ! IntelliJ!

JavaからScalaにチームで移行するには -> エンジニアとしての知見に基づいたマネージメントスキル！検証！
